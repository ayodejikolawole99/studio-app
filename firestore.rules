/**
 * @fileoverview Firestore Security Rules for the Canteen System.
 *
 * Core Philosophy:
 * This ruleset is designed for an application using anonymous authentication. The system allows for management of employee records and tracking of feeding events.
 *
 * Data Structure:
 * - /employees/{employeeId}: Stores employee profiles, using the employeeId as the document ID.
 * - /feedingRecords/{recordId}: Logs feeding events with denormalized employee data.
 *
 * Key Security Decisions:
 * - Employees collection and feedingRecords collection are open to everyone.
 *
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Manages employee profiles.  Allows anyone to read or create employee profiles.
     * @path /employees/{employeeId}
     * @allow (get, list): Anyone can read employee profiles.
     * @allow (create): Anyone can create a new employee profile where the document ID matches the employeeId in the request.
     * @allow (update, delete): No one can update or delete an employee profile.
     * @deny (create): If the employeeId in the document does not match the document ID.
     * @principle Allows public read access to employee profiles, but requires the `employeeId` in the document to match the document ID for `create` operations.
     */
    match /employees/{employeeId} {
      allow get, list: if true;
      allow create: if request.resource.data.id == employeeId;
      allow update, delete: if false;
    }

    /**
     * @description Stores records of employee feeding events.  Anyone can read or create feeding records.
     * @path /feedingRecords/{recordId}
     * @allow (get, list): Anyone can read the list of feeding records.
     * @allow (create): Anyone can create a feeding record.
     * @allow (update, delete): No one can update or delete a feeding record.
     * @principle Allows public read access to feeding records and allows everyone to create new records.
     */
    match /feedingRecords/{recordId} {
      allow get, list: if true;
      allow create: if true;
      allow update, delete: if false;
    }
  }
}